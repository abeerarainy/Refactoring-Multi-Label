import pandas as pd

# Load the dataset
file_path = r"C:\Users\HP\Dropbox\PHD\level 2\SWE620\project\Fdroid\Fdroid_type1_feature2.csv"
df = pd.read_csv(file_path)

# Define the unique refactoring labels
refactoring_labels = df['refactoring'].unique()

# Initialize new columns for each refactoring type with 0
for label in refactoring_labels:
    df[label] = 0


# Group by 'className', aggregating features with max value and counting occurrences
grouped_df = df.groupby('className').agg({
    **{col: 'max' for col in df.columns if col not in ['className', 'refactoring']},
    'refactoring': lambda x: list(x)  # Keep refactoring types as a list for processing
}).reset_index()

# Convert refactoring occurrences to multi-label format
for index, row in grouped_df.iterrows():
    for label in row['refactoring']:  # Iterate through the list of refactoring types
        grouped_df.at[index, label] = 1


# Drop the original refactoring column
grouped_df = grouped_df.drop(columns=['refactoring'])

# Save the processed dataset
output_file_path = r"C:\Users\HP\Dropbox\PHD\level 2\SWE620\project\Fdroid\multi_label_no_balance.csv"
grouped_df.to_csv(output_file_path, index=False)

print(f"Processed dataset saved to: {output_file_path}")